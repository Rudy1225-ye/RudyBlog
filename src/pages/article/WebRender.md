---
title: "Web渲染性能"
date: "2024/08"
author: "Rudy"
tags: "Web性能优化"
id: "1"
desc: "Web渲染性能是衡量Web应用性能的重要指标之一。它涉及到浏览器如何将HTML、CSS和JavaScript代码转换为用户可以与之交互的视觉界面。Web渲染性能的好坏直接影响到用户的体验和满意度。"
---

# Web渲染性能

Web渲染性能是衡量Web应用性能的重要指标之一。它涉及到浏览器如何将HTML、CSS和JavaScript代码转换为用户可以与之交互的视觉界面。Web渲染性能的好坏直接影响到用户的体验和满意度。

## 1. 浏览器渲染过程

1. 解析HTML生成DOM树

2. 解析CSS生成CSSOM树

3. 将DOM树和CSSOM树结合，生成渲染树

4. 根据渲染树进行布局，计算每个节点的位置和大小

5. 根据渲染树和布局信息，绘制页面

   ![renderimg](@/assets/renderimg.png)

## 2. 性能优化

1. ### 避免不重要的重排：

   **重排（Reflow）**：重排会导致浏览器重新计算页面布局，并重绘页面。避免频繁地直接操作 DOM，尽量使用批量操作或使用 `classList` 一次性操作样式，以减少重排的次数。

   **如何避免**：如果需要频繁更新页面元素的样式或布局，考虑使用 `DocumentFragment` 进行离线 DOM 操作，然后一次性将结果添加到文档中。

2. ### 尽量使用CSS来创建动画：

   **CSS 动画 vs. JavaScript 动画**：CSS 动画通常运行在浏览器的复合线程上，避免了主线程的阻塞，性能更好。使用硬件加速属性（如 `transform`、`opacity`）可以进一步优化性能。

   **transform 和 opacity**：使用 `transform` 和 `opacity` 创建动画可以避免触发重排和重绘，因为它们不影响元素的布局。

3. ### 优化媒体资源的加载：

   **aspect-ratio**：通过设置 `aspect-ratio`，浏览器可以在图片加载前预留出正确的空间，避免图片加载后导致的布局抖动和重排。

   对于首屏图片一定要加上aspect-ratio，浏览器解析到aspect-ratio就会自动计算好首屏图片所需要的占位，这样就可以在未加载出图片时提前计算好布局，避免出现图片加载后的布局抖动和重排。

   **延迟加载**：使用 `loading="lazy"` 属性为非首屏图片延迟加载，这样只有当用户滚动到图片所在的位置时才会加载，减少页面初始加载的资源占用。

   对于非首屏图片或可能不会访问的图片，使用延迟加载来减少页面初始加载时间

   **压缩图片和其他媒体资源**：利用工具（如 ImageMagick、Squoosh）压缩图片，并在保证用户体验的前提下尽可能减小文件体积。

   尽量在保证图片质量的情况下压缩文件大小，其他媒体资源如视频资源也是一样

   **预加载关键资源**：使用 `<link rel="preload">` 提前加载关键资源如字体，确保在页面加载时这些资源已经准备好，减少 FOUC（Flash of Unstyled Content）现象。

   例如加载网络字体等影响页面的样式链接也要提前加载好，避免图片文字已经出现后再出现字体样式导影响网页性能和用户体验

4. ### FSL强制同步布局（Forced Synchronous Layout）：

   **FSL 问题**：当你在同一个任务中同时读取和写入 DOM 时，浏览器可能会触发强制同步布局，导致性能下降。通过将读取操作和写入操作分开，可以避免这种情况。

   避免在同一个 JavaScript 任务中读取和修改 DOM 元素的尺寸或位置，否则浏览器可能会强制同步布局，造成性能问题。例如，先读取所有需要的值，再进行更新。

5. ### 针对优化Js动画

   **requestAnimationFrame**：使用 `requestAnimationFrame` 可以确保动画在浏览器的重绘周期中执行，避免页面卡顿。它会在每次重绘之前调用回调函数，使动画更加流畅。

6. ### 使用Web Workers

   **多线程处理**：Web Workers 允许你将复杂的计算任务移到主线程之外的后台线程中运行，避免阻塞 UI 线程，提高页面响应速度。

   **适用场景**：适合用于处理大量数据计算、复杂逻辑处理或长时间运行的任务，如图片处理、数据解析等。

7. ### Web Assembly

   **性能优化**：WebAssembly 是一种低级编程语言，可以让你在浏览器中运行接近原生速度的代码，适用于需要高性能的应用场景，如游戏引擎、视频处理器等。

   **适用场景**：特别适合处理性能瓶颈的部分，比如复杂算法、实时处理等。

   

   #### 通过结合使用这些策略，可以显著提升 Web 应用的渲染性能，提供更好的用户体验。不同的应用和场景可能需要不同的优化策略，了解每种技术的适用范围和限制将帮助更有效地优化项目。

   